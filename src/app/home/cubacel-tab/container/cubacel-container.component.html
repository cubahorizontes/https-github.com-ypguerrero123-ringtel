<div *ngIf="rechargeService.cubacelRecharges">

    <ion-card class="shadow-lg" mode="md">

        <mat-tab-group dynamicHeight selectedIndex="1">
            <mat-tab label="Recarga simple">
                <ion-card-content>

                    <form [formGroup]="cubacelForm">

                        <div class="form-group">
                            <ion-label class="">Nombre:</ion-label>
                            <input [class.error-input]="!formControl.client.valid && (formControl.client.dirty || formControl.client.touched)"
                                   [matAutocomplete]="autoName" aria-describedby="nameHelp" aria-label=""
                                   autocomplete="off" formControlName="client" id="client"
                                   matInput maxlength="50" minlength="2" placeholder="Nombre del cliente"
                                   type="text">
                            <mat-autocomplete #autoName="matAutocomplete"
                                              (optionSelected)='optionSelected($event.option.value)'>
                                <mat-option *ngFor="let conctactList of filteredNames | async"
                                            [value]="conctactList.name">
                                    {{conctactList.name}}
                                    <b>{{conctactList.phone}}</b>
                                </mat-option>
                            </mat-autocomplete>
                            <!-- Error messages -->
                            <span *ngIf="formControl.client.errors?.minlength && (formControl.client.dirty || formControl.client.touched)"
                                  class="error">
                        Nombre del cliente de 2 caracteres mínimo.
                    </span>
                        </div>
                        <div class="form-group">
                            <ion-label class="required">Teléfono:</ion-label>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <button class="btn btn-outline-secondary" type="button">+53</button>
                                </div>
                                <ion-input [(ngModel)]="phoneByContactName"
                                           [class.error-input]="!formControl.account.valid && (formControl.account.dirty || formControl.account.touched)"
                                           aria-describedby="telHelp"
                                           autocomplete="off" formControlName="account" id="account"
                                           maxlength="8" placeholder="Número del cliente"
                                           type="tel"></ion-input>
                            </div>
                            <!-- Error messages -->
                            <span *ngIf="formControl.account.errors?.required && (formControl.account.dirty || formControl.account.touched)"
                                  class="error">
                        Teléfono del cliente es obligatorio.
                    </span>
                            <span *ngIf="formControl.account.errors?.pattern && (formControl.account.dirty || formControl.account.touched)"
                                  class="error">
                       Número cubacel no válido
                        </span>
                        </div>
                        <div class="form-group">
                            <ion-label class="required">Recargas disponibles:</ion-label>
                            <ion-select (keyup.enter)="onSubmit()" aria-describedby="priceHelp" okText="Seleccionar"
                                        cancelText="Cancelar"
                                        formControlName="recharge"
                                        placeholder="Seleccione un valor">
                                <ion-select-option *ngFor="let item of rechargeService.cubacelRecharges;"
                                                   [value]="item.id">{{item.slug}}</ion-select-option>
                            </ion-select>
                        </div>
                        <div class="form-group"
                             *ngIf="(rechargeService.allSalesActive && rechargeService.appService.isPostSale()) || (!rechargeService.appService.isPostSale())">
                            <ion-radio-group value="{{action}}">
                                <ion-item (click)="setAction(1)" class="ion-no-padding custom-radio-group" lines="none">
                                    <ion-radio class="mr-2" color="primary" value="1"></ion-radio>
                                    <ion-label>Recargar ahora</ion-label>
                                </ion-item>
                                <ion-item (click)="setAction(3)"
                                          *ngIf="rechargeService.preSalesActive && rechargeService.appService.isPostSale()"
                                          class="ion-no-padding custom-radio-group" lines="none">
                                    <ion-radio class="mr-2" color="success" value="3"></ion-radio>
                                    <ion-label>Enviar en preventa</ion-label>
                                </ion-item>
                                <ion-item (click)="setAction(2)" class="ion-no-padding custom-radio-group" lines="none">
                                    <ion-radio class="mr-2" color="tertiary" value="2"></ion-radio>
                                    <ion-label>Enviar recarga al carrito</ion-label>
                                </ion-item>
                            </ion-radio-group>
                        </div>
                        <div class="form-group mb-0">
                            <ion-button color="primary" expand="block" (click)="onSubmit()">
                                {{buttonSubmitText}}
                            </ion-button>
                        </div>

                    </form>

                </ion-card-content>
            </mat-tab>
            <mat-tab label="Recarga por lotes" *ngIf="rechargeService.appService.isPostSale()">
                <ion-card-content>

                    <form [formGroup]="cubacelFormFile">

                        <div class="">
                            <ion-input formControlName="inputFile" hidden
                                       type="text"></ion-input>
                            <ion-input #inputHiddenFile style="opacity: 0; position: absolute"
                                       (ionChange)="chooserFile($event, textarea)"
                                       type="file"></ion-input>
                        </div>

                        <div class="form-group">
                            <ion-label class="required">Escribir o pegar números:</ion-label>
                            <ion-textarea
                                    [class.error-input]="!formControlFile.textAreaNumbers.valid && (formControlFile.textAreaNumbers.dirty || formControlFile.textAreaNumbers.touched)"
                                    inputmode="tel" id="textarea" #textarea formControlName="textAreaNumbers"
                                    rows="5" (ionInput)="addEventListenerTextArea(textarea)">
                                <div id="placeholder">
                                    <p>Para números múltiples: no. + cantidad </p>
                                    <p>Ejemplo de número válidos</p>
                                    <p>58099362+5</p>
                                    <p>58099362</p>
                                    <p>55952753+3</p>
                                </div>
                            </ion-textarea>

                            <ion-button size="small" style="float: right" (click)="activeEventGetFile(inputHiddenFile)"
                                        [color]="(!formControlFile.inputFile.valid && (formControlFile.inputFile.dirty || formControlFile.inputFile.touched)) ? 'danger' : 'primary'">
                                <ion-icon name="cloud-upload-outline"></ion-icon>
                            </ion-button>

                            <!-- Error messages -->
                            <span *ngIf="formControlFile.textAreaNumbers.errors?.required && (formControlFile.textAreaNumbers.dirty || formControlFile.textAreaNumbers.touched)"
                                  class="error">
                                Seleccione o escribir un lote obligatorio.
                            </span>
                            <span *ngIf="formControlFile.inputFile.errors?.inValidExt && (formControlFile.inputFile.dirty || formControlFile.inputFile.touched)"
                                  class="error">
                                Extensión de archivo no válida.
                            </span>
                            <span *ngIf="formControlFile.textAreaNumbers.errors?.inValidTextAreaMaxNumbers && (formControlFile.textAreaNumbers.dirty || formControlFile.textAreaNumbers.touched)"
                                  class="error">
                                 Máximo de 100 líneas.
                            </span>
                        </div>
                        <div class="form-group">
                            <ion-label class="required">Recargas disponibles:</ion-label>
                            <ion-select (keyup.enter)="onSubmit()" aria-describedby="priceHelp" okText="Seleccionar"
                                        cancelText="Cancelar"
                                        formControlName="recharge"
                                        placeholder="Seleccione un valor">
                                <ion-select-option *ngFor="let item of rechargeService.cubacelRecharges;"
                                                   [value]="item.id">{{item.slug}}</ion-select-option>
                            </ion-select>
                        </div>
                        <div class="form-group">
                            <ion-radio-group value="{{action}}">
                                <ion-item (click)="setAction(1)"
                                          *ngIf="rechargeService.allSalesActive && rechargeService.appService.isPostSale()"
                                          class="ion-no-padding custom-radio-group" lines="none">
                                    <ion-radio class="mr-2" color="primary" value="1"></ion-radio>
                                    <ion-label>Recargar ahora</ion-label>
                                </ion-item>
                                <ion-item (click)="setAction(3)"
                                          *ngIf="rechargeService.preSalesActive && rechargeService.appService.isPostSale()"
                                          class="ion-no-padding custom-radio-group" lines="none">
                                    <ion-radio class="mr-2" color="success" value="3"></ion-radio>
                                    <ion-label>Enviar en preventa</ion-label>
                                </ion-item>
                                <ion-item (click)="setAction(2)"
                                          *ngIf="rechargeService.allSalesActive && rechargeService.appService.isPostSale()"
                                          class="ion-no-padding custom-radio-group" lines="none">
                                    <ion-radio class="mr-2" color="tertiary" value="2"></ion-radio>
                                    <ion-label>Enviar recarga al carrito</ion-label>
                                </ion-item>
                            </ion-radio-group>
                        </div>
                        <div class="form-group mb-0">
                            <ion-button color="primary" expand="block" (click)="onSubmitFile()">
                                {{buttonSubmitText}}
                            </ion-button>
                        </div>

                    </form>

                </ion-card-content>
            </mat-tab>
        </mat-tab-group>

    </ion-card>

</div>


<ion-spinner *ngIf="!rechargeService.cubacelRecharges" class="loading" color="primary" name="lines"></ion-spinner>
